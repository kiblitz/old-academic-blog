<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Taking out the memory allocated trash"><title>Garbage Collection</title><link rel=canonical href=https://kiblitz.github.io/p/garbage-collection/><link rel=stylesheet href=/scss/style.min.ff300df33b80e2ac49809c825614392ed1c7b27591d65d3c4043602cd162e25f.css><meta property="og:title" content="Garbage Collection"><meta property="og:description" content="Taking out the memory allocated trash"><meta property="og:url" content="https://kiblitz.github.io/p/garbage-collection/"><meta property="og:site_name" content="glee"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="reference counting"><meta property="article:tag" content="mark sweep"><meta property="article:tag" content="copy collection"><meta property="article:tag" content="generational collection"><meta property="article:tag" content="conservative collection"><meta property="article:published_time" content="2023-07-17T00:00:00+00:00"><meta property="article:modified_time" content="2023-07-17T00:00:00+00:00"><meta property="og:image" content="https://kiblitz.github.io/p/garbage-collection/garbage.jpg"><meta name=twitter:title content="Garbage Collection"><meta name=twitter:description content="Taking out the memory allocated trash"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://kiblitz.github.io/p/garbage-collection/garbage.jpg"><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.setItem(e,"dark")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/github_rose_hu71d01ed01b9b33c6474b1801f0b5f44b_20195_300x0_resize_q75_box.jpeg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a>
<span class=emoji>ðŸ’•</span></figure><div class=site-meta><h1 class=site-name><a href=/>glee</a></h1><h2 class=site-description>mia Â· pgh Â· nyc</h2></div></header><ol class=social-menu><li><a href=https://linkedin.com/in/gabrielelee target=_blank title=LinkedIn rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-linkedin" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4m0 2a2 2 0 012-2h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2z"/><path d="M8 11v5"/><path d="M8 8v.01"/><path d="M12 16v-5"/><path d="M16 16v-3a2 2 0 00-4 0"/></svg></a></li><li><a href=https://github.com/kiblitz target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=mailto:g.lee13770334@gmail.com target=_blank title=Gmail rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-gmail" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M16 20h3a1 1 0 001-1V5a1 1 0 00-1-1h-3v16z"/><path d="M5 20h3V4H5A1 1 0 004 5v14a1 1 0 001 1z"/><path d="M16 4l-4 4-4-4"/><path d="M4 6.5l8 7.5 8-7.5"/></svg></a></li><li><a href=https://lichess.org/@/ozzieshazam target=_blank title=Lichess rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chess" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#2c3e50" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 3a3 3 0 013 3c0 1.113-.6 2.482-1.5 3l1.5 7H9l1.5-7C9.6 8.482 9 7.113 9 6a3 3 0 013-3z"/><path d="M8 9h8"/><path d="M6.684 16.772A1 1 0 006 17.721V19a1 1 0 001 1h10a1 1 0 001-1v-1.28a1 1 0 00-.684-.948L15 16H9l-2.316.772z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><li><a href=/doodles/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-scribble" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 15c2 3 4 4 7 4s7-3 7-7-3-7-6-7-5 1.5-5 4 2 5 6 5 8.408-2.453 10-5"/></svg><span>Doodles</span></a></li><li><a href=/links/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg><span>Links</span></a></li><div class=menu-bottom-section></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#introduction>Introduction</a></li><li><a href=#techniques>Techniques</a><ol><li><a href=#reference-counting>Reference Counting</a><ol><li><a href=#algorithm>Algorithm</a></li><li><a href=#pros>Pros</a></li><li><a href=#cons>Cons</a></li></ol></li><li><a href=#mark-sweep>Mark Sweep</a><ol><li><a href=#algorithm-1>Algorithm</a></li><li><a href=#pros-1>Pros</a></li><li><a href=#cons-1>Cons</a></li></ol></li><li><a href=#copy-collection>Copy Collection</a><ol><li><a href=#algorithm-2>Algorithm</a></li><li><a href=#example>Example</a></li><li><a href=#pros-2>Pros</a></li><li><a href=#cons-2>Cons</a></li></ol></li></ol></li><li><a href=#lifetime-optimization>Lifetime Optimization</a></li><li><a href=#type-unsafe-problem>Type Unsafe Problem</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/garbage-collection/><img src=/p/garbage-collection/garbage_hu7d8e2c49ec3f83d7a49149b6e4e77e19_1148135_800x0_resize_q75_box.jpg srcset="/p/garbage-collection/garbage_hu7d8e2c49ec3f83d7a49149b6e4e77e19_1148135_800x0_resize_q75_box.jpg 800w, /p/garbage-collection/garbage_hu7d8e2c49ec3f83d7a49149b6e4e77e19_1148135_1600x0_resize_q75_box.jpg 1600w" width=800 height=533 loading=lazy alt="Featured image of post Garbage Collection"></a></div><div class=article-details><header class=article-category><a href=/categories/memory-management/>memory management</a>
<a href=/categories/algorithms/>algorithms</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/garbage-collection/>Garbage Collection</a></h2><h3 class=article-subtitle>Taking out the memory allocated trash</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Jul 17, 2023</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>6 minute read</time></div></footer></div></header><section class=article-content><h2 id=introduction>Introduction</h2><p>Oftentimes, your program will need to allocate memory on the heap. Unlike the stack where deallocations occur upon scope exiting, something needs to explicitly free memory from the heap.</p><p>In some languages like $\texttt{C}$, it is the programmer&rsquo;s responsibility to call $\texttt{free}$ when it is no longer needed. Manual memory leak debugging and tests were required (i.e. <a class=link href=https://en.wikipedia.org/wiki/Valgrind target=_blank rel=noopener>valgrind</a>).</p><p>A lot of higher-level programming languages have a &ldquo;garbage collector&rdquo; (gc). Aptly named, they execute independently of the main program and free memory that is no longer being used (garbage).</p><h2 id=techniques>Techniques</h2><p>Garbage collection is a difficult task. There is a juggling tradeoff between the completeness of the gc (what leaks can we allow) versus the resource complexity of the gc (time, space, processing).</p><h3 id=reference-counting>Reference Counting</h3><p>For every allocated piece of memory, store a referencing counter representing the number of pointers that point to it. If it ever reaches $0$, free the memory chunk.</p><h4 id=algorithm>Algorithm</h4><p>$$
\begin{align*}
&\texttt{on new $M$:}\newline
&\texttt{\qquad $M$.ref\_count = 1}\newline
&\newline
&\texttt{on $x$ = $M$:}\newline
&\texttt{\qquad $M$.ref\_count++}\newline
&\newline
&\texttt{on ($x$ = $M$) out of scope:}\newline
&\texttt{\qquad $M$.ref\_count--}\newline
&\texttt{\qquad if $M$.ref\_count = 0}\newline
&\texttt{\qquad \qquad free($M$)}\newline
&\texttt{\qquad \qquad recurse out-of-scope check on $M$ fields}
\end{align*}
$$</p><h4 id=pros>Pros</h4><ul><li>Very simple to implement</li><li>No background thread running in background (all operations are triggered)</li></ul><h4 id=cons>Cons</h4><ul><li>Word overhead for storing $\texttt{ref\_count}$ per allocated memory block</li><li>Chain overhead when freeing a linked data structure<style type=text/css>.box-shortcode{padding:1.6em;padding-top:1.4em;line-height:1.4em;margin-top:1em;margin-bottom:2em;border-radius:4px;color:#444;background:#f3ebe850}.box-title{margin:-18px -18px 12px;padding:4px 18px;border-radius:4px 4px 0 0;font-weight:700;color:#fff;background:#6ab0de}.box-shortcode.warning .box-title{background:#ff6b6b}.box-shortcode.warning{background:#ff5b5bc6}.box-shortcode.info .box-title{background:#0089e488}.box-shortcode.info{background:#87ceffc0;box-shadow:3px 3px 5px #0089e410}.box-shortcode.important .box-title{background:#f7ec2c}.box-shortcode.important{background:#f7ec2c7d}.box-shortcode.tip .box-title{background:#a3ffa36d}.box-shortcode.tip{background:#a3ffa36d;box-shadow:3px 3px 5px #0089e410}.icon-box{display:inline-flex;align-self:center;margin-right:8px}.icon-box img,.icon-box svg{height:1em;width:1em;fill:currentColor}.icon-box img,.icon-box.baseline svg{top:.125em;position:relative}.box-shortcode p{margin-bottom:.6em}.box-shortcode p:first-of-type{display:inline}.box-shortcode p:nth-of-type(2){margin-top:.6em}.box-shortcode p:last-child{margin-bottom:0}</style><svg width="0" height="0" display="none" xmlns="http://www.w3.org/2000/svg"><symbol id="tip-box" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379.0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628.0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628.0l-22.627 22.627c-6.248 6.248-6.248 16.379.0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"/></symbol><symbol id="important-box" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zm-248 50c-25.405.0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346 7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373.0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884.0-12.356 5.78-11.981 12.654z"/></symbol><symbol id="warning-box" viewBox="0 0 576 512" preserveAspectRatio="xMidYMid meet"><path d="M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937.0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154.0l239.94 416.028zM288 354c-25.405.0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346 7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373.0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884.0-12.356 5.78-11.981 12.654z"/></symbol><symbol id="info-box" viewBox="0 0 512 512" preserveAspectRatio="xMidYMid meet"><path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196.0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627.0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627.0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627.0 12 5.373 12 12v1e2h12c6.627.0 12 5.373 12 12v24z"/></symbol></svg><div class="box box-shortcode info"><span class="icon-box baseline"><svg><use href="#info-box"/></svg></span><p><div class="goat svg-container"><svg xmlns="http://www.w3.org/2000/svg" font-family="Menlo,Lucida Console,monospace" viewBox="0 0 336 25"><g transform="translate(8,16)"><path d="M16 0H40" fill="none" stroke="currentcolor"/><path d="M80 0h24" fill="none" stroke="currentcolor"/><path d="M144 0h24" fill="none" stroke="currentcolor"/><path d="M208 0h24" fill="none" stroke="currentcolor"/><path d="M272 0h24" fill="none" stroke="currentcolor"/><polygon points="48.000000,0.000000 36.000000,-5.600000 36.000000,5.600000" fill="currentcolor" transform="rotate(0.000000, 40.000000, 0.000000)"/><polygon points="112.000000,0.000000 100.000000,-5.600000 100.000000,5.600000" fill="currentcolor" transform="rotate(0.000000, 104.000000, 0.000000)"/><polygon points="176.000000,0.000000 164.000000,-5.600000 164.000000,5.600000" fill="currentcolor" transform="rotate(0.000000, 168.000000, 0.000000)"/><polygon points="240.000000,0.000000 228.000000,-5.600000 228.000000,5.600000" fill="currentcolor" transform="rotate(0.000000, 232.000000, 0.000000)"/><polygon points="304.000000,0.000000 292.000000,-5.600000 292.000000,5.600000" fill="currentcolor" transform="rotate(0.000000, 296.000000, 0.000000)"/><text text-anchor="middle" x="0" y="4" fill="currentcolor" style="font-size:1em">A</text><text text-anchor="middle" x="64" y="4" fill="currentcolor" style="font-size:1em">B</text><text text-anchor="middle" x="128" y="4" fill="currentcolor" style="font-size:1em">C</text><text text-anchor="middle" x="192" y="4" fill="currentcolor" style="font-size:1em">D</text><text text-anchor="middle" x="256" y="4" fill="currentcolor" style="font-size:1em">E</text><text text-anchor="middle" x="320" y="4" fill="currentcolor" style="font-size:1em">F</text></g></svg></div><p>Imagine $\texttt{A}$ is freed. Then, $\texttt{B}$ is freed. Then, $\texttt{C}$ is freed. And so on. So there is a potential high overhead when freeing linked data structures (program pause).</p></p></div></li><li><strong>Cycles leak memory</strong><div class="box box-shortcode info"><span class="icon-box baseline"><svg><use href="#info-box"/></svg></span><p><div class="goat svg-container"><svg xmlns="http://www.w3.org/2000/svg" font-family="Menlo,Lucida Console,monospace" viewBox="0 0 336 89"><g transform="translate(8,16)"><path d="M16 0H40" fill="none" stroke="currentcolor"/><path d="M24 64H48" fill="none" stroke="currentcolor"/><path d="M0 32V48" fill="none" stroke="currentcolor"/><path d="M64 16V32" fill="none" stroke="currentcolor"/><polygon points="8.000000,32.000000 -4.000000,26.400000 -4.000000,37.599998" fill="currentcolor" transform="rotate(270.000000, 0.000000, 32.000000)"/><polygon points="32.000000,64.000000 20.000000,58.400002 20.000000,69.599998" fill="currentcolor" transform="rotate(180.000000, 24.000000, 64.000000)"/><polygon points="48.000000,0.000000 36.000000,-5.600000 36.000000,5.600000" fill="currentcolor" transform="rotate(0.000000, 40.000000, 0.000000)"/><polygon points="72.000000,32.000000 60.000000,26.400000 60.000000,37.599998" fill="currentcolor" transform="rotate(90.000000, 64.000000, 32.000000)"/><text text-anchor="middle" x="0" y="4" fill="currentcolor" style="font-size:1em">A</text><text text-anchor="middle" x="0" y="68" fill="currentcolor" style="font-size:1em">D</text><text text-anchor="middle" x="64" y="4" fill="currentcolor" style="font-size:1em">B</text><text text-anchor="middle" x="64" y="68" fill="currentcolor" style="font-size:1em">C</text></g></svg></div><p>These nodes point to each other. So, their $\texttt{ref\_count}$ will never be $0$ even if nothing else in the program points to them (should be garbage).</p></p></div><div class="box box-shortcode tip"><span class="icon-box baseline"><svg><use href="#tip-box"/></svg></span><p><a class=link href=https://en.wikipedia.org/wiki/Python_%28programming_language%29 target=_blank rel=noopener>Python</a> uses reference counting for its gc. Watch it leak by making a large number of cycle structures.</p></div></li></ul><h3 id=mark-sweep>Mark Sweep</h3><p>For every allocated block of memory, store a mark bit (initialized to $0$). Every now and then, mark all memory that have pointers to them within the current program scope. Free all allocated memory that has not been marked (cannot be accessed $\implies$ garbage). Unmark all marks.</p><h4 id=algorithm-1>Algorithm</h4><p>$$
\begin{align*}
&\texttt{let markRecurse(ptr $p$):}\newline
&\texttt{\qquad if $p$ is marked then return}\newline
&\texttt{\qquad mark $p$}\newline
&\texttt{\qquad for all pointers $f$ that are fields of $p$:}\newline
&\texttt{\qquad \qquad markRecurse($f$)}\newline
&\newline
&\texttt{on gc trigger:}\newline
&\texttt{\qquad pause program}\newline
&\newline
&\texttt{\qquad // mark phase}\newline
&\texttt{\qquad for all pointers $p$ in scope:}\newline
&\texttt{\qquad \qquad markRecurse($p$)}\newline
&\newline
&\texttt{\qquad // sweep phase}\newline
&\texttt{\qquad for all allocated memory blocks $b$:}\newline
&\texttt{\qquad \qquad if $b$ is marked then free($b$)}\newline
&\texttt{\qquad \qquad unmark $b$}\newline
&\newline
&\texttt{\qquad resume program}
\end{align*}
$$</p><div class="box box-shortcode info"><span class="icon-box baseline"><svg><use href="#info-box"/></svg></span><p>The gc trigger is heuristical. It could be based on time intervals, memory utilization, processor utilization, etc.</p></div><h4 id=pros-1>Pros</h4><ul><li>The gc will collect all garbage</li></ul><h4 id=cons-1>Cons</h4><ul><li>Long pauses when gc is running</li></ul><h3 id=copy-collection>Copy Collection</h3><p>Divide the heap into two equal sections: <em>from</em> and <em>to</em>. For every allocated block of memory, store a &ldquo;forwarding address&rdquo; (initialized to $0$). All newly allocated blocks are placed in the <em>from</em> space. Once full, the gc is triggered. It moves all non-garbage blocks to the <em>to</em> space and frees the <em>from</em> space. Then, it swaps the <em>from</em> and <em>to</em> space labels.</p><h4 id=algorithm-2>Algorithm</h4><p>$$
\begin{align*}
&\texttt{let copyRecurse(ptr $p$):}\newline
&\texttt{\qquad if $p$ has no forwarding address:}\newline
&\texttt{\qquad \qquad let $m$ = next available block in $to$ space}\newline
&\texttt{\qquad \qquad copy non-ptr fields of $p$ into $m$}\newline
&\texttt{\qquad \qquad $p$ forwarding address = $m$ (in $from$ space)}\newline
&\texttt{\qquad \qquad for all ptr fields $f$ of $p$:}\newline
&\texttt{\qquad \qquad \qquad $f$ forwarding address = copyRecurse($f$)}\newline
&\texttt{\qquad return $p$ forwarding address}\newline
&\newline
&\texttt{on gc trigger:}\newline
&\texttt{\qquad pause program}\newline
&\newline
&\texttt{\qquad for all pointers $p$ in scope:}\newline
&\texttt{\qquad \qquad copyRecurse($p$)}\newline
&\texttt{\qquad free($from$ space)}\newline
&\newline
&\texttt{\qquad swap $to$ and $from$ labels}\newline
&\newline
&\texttt{\qquad resume program}
\end{align*}
$$</p><div class="box box-shortcode info"><span class="icon-box baseline"><svg><use href="#info-box"/></svg></span><p>The &ldquo;forwarding address&rdquo; is for the gc to move cyclical data structures to the <em>to</em> space.</p><p>Without it, recursing on pointers to blocks already in the <em>to</em> space will move the same block again (essentially duplicating it infinitely in the <em>to</em> space).</p><div class="goat svg-container"><svg xmlns="http://www.w3.org/2000/svg" font-family="Menlo,Lucida Console,monospace" viewBox="0 0 328 377"><g transform="translate(8,16)"><path d="M0 0H72" fill="none" stroke="currentcolor"/><path d="M72 0h72" fill="none" stroke="currentcolor"/><path d="M168 0h72" fill="none" stroke="currentcolor"/><path d="M240 0h72" fill="none" stroke="currentcolor"/><path d="M16 48H32" fill="none" stroke="currentcolor"/><path d="M184 48h16" fill="none" stroke="currentcolor"/><path d="M16 112H32" fill="none" stroke="currentcolor"/><path d="M184 112h16" fill="none" stroke="currentcolor"/><path d="M0 128H72" fill="none" stroke="currentcolor"/><path d="M72 128h72" fill="none" stroke="currentcolor"/><path d="M168 128h72" fill="none" stroke="currentcolor"/><path d="M240 128h72" fill="none" stroke="currentcolor"/><path d="M0 160H72" fill="none" stroke="currentcolor"/><path d="M72 160h72" fill="none" stroke="currentcolor"/><path d="M168 160h72" fill="none" stroke="currentcolor"/><path d="M240 160h72" fill="none" stroke="currentcolor"/><path d="M16 208H32" fill="none" stroke="currentcolor"/><path d="M184 208h16" fill="none" stroke="currentcolor"/><path d="M16 272H32" fill="none" stroke="currentcolor"/><path d="M184 272h16" fill="none" stroke="currentcolor"/><path d="M0 288H72" fill="none" stroke="currentcolor"/><path d="M72 288h72" fill="none" stroke="currentcolor"/><path d="M168 352h72" fill="none" stroke="currentcolor"/><path d="M240 352h72" fill="none" stroke="currentcolor"/><path d="M0 0V128" fill="none" stroke="currentcolor"/><path d="M0 160V288" fill="none" stroke="currentcolor"/><path d="M16 48v64" fill="none" stroke="currentcolor"/><path d="M16 208v64" fill="none" stroke="currentcolor"/><path d="M48 64V80" fill="none" stroke="currentcolor"/><path d="M48 224v16" fill="none" stroke="currentcolor"/><path d="M72 0V128" fill="none" stroke="currentcolor"/><path d="M72 160V288" fill="none" stroke="currentcolor"/><path d="M104 224v16" fill="none" stroke="currentcolor"/><path d="M144 0V128" fill="none" stroke="currentcolor"/><path d="M144 160V288" fill="none" stroke="currentcolor"/><path d="M168 0V128" fill="none" stroke="currentcolor"/><path d="M168 160V352" fill="none" stroke="currentcolor"/><path d="M184 48v64" fill="none" stroke="currentcolor"/><path d="M184 208v64" fill="none" stroke="currentcolor"/><path d="M216 64V80" fill="none" stroke="currentcolor"/><path d="M216 224v16" fill="none" stroke="currentcolor"/><path d="M240 0V128" fill="none" stroke="currentcolor"/><path d="M240 160V352" fill="none" stroke="currentcolor"/><path d="M272 224v16" fill="none" stroke="currentcolor"/><path d="M272 288v16" fill="none" stroke="currentcolor"/><path d="M312 0V128" fill="none" stroke="currentcolor"/><path d="M312 160V352" fill="none" stroke="currentcolor"/><polygon points="40.000000,48.000000 28.000000,42.400002 28.000000,53.599998" fill="currentcolor" transform="rotate(0.000000, 32.000000, 48.000000)"/><polygon points="40.000000,208.000000 28.000000,202.399994 28.000000,213.600006" fill="currentcolor" transform="rotate(0.000000, 32.000000, 208.000000)"/><polygon points="56.000000,80.000000 44.000000,74.400002 44.000000,85.599998" fill="currentcolor" transform="rotate(90.000000, 48.000000, 80.000000)"/><polygon points="56.000000,240.000000 44.000000,234.399994 44.000000,245.600006" fill="currentcolor" transform="rotate(90.000000, 48.000000, 240.000000)"/><polygon points="112.000000,240.000000 100.000000,234.399994 100.000000,245.600006" fill="currentcolor" transform="rotate(90.000000, 104.000000, 240.000000)"/><polygon points="208.000000,48.000000 196.000000,42.400002 196.000000,53.599998" fill="currentcolor" transform="rotate(0.000000, 200.000000, 48.000000)"/><polygon points="208.000000,208.000000 196.000000,202.399994 196.000000,213.600006" fill="currentcolor" transform="rotate(0.000000, 200.000000, 208.000000)"/><polygon points="224.000000,80.000000 212.000000,74.400002 212.000000,85.599998" fill="currentcolor" transform="rotate(90.000000, 216.000000, 80.000000)"/><polygon points="224.000000,240.000000 212.000000,234.399994 212.000000,245.600006" fill="currentcolor" transform="rotate(90.000000, 216.000000, 240.000000)"/><polygon points="280.000000,240.000000 268.000000,234.399994 268.000000,245.600006" fill="currentcolor" transform="rotate(90.000000, 272.000000, 240.000000)"/><polygon points="280.000000,304.000000 268.000000,298.399994 268.000000,309.600006" fill="currentcolor" transform="rotate(90.000000, 272.000000, 304.000000)"/><text text-anchor="middle" x="24" y="20" fill="currentcolor" style="font-size:1em">f</text><text text-anchor="middle" x="24" y="180" fill="currentcolor" style="font-size:1em">f</text><text text-anchor="middle" x="32" y="20" fill="currentcolor" style="font-size:1em">r</text><text text-anchor="middle" x="32" y="180" fill="currentcolor" style="font-size:1em">r</text><text text-anchor="middle" x="40" y="20" fill="currentcolor" style="font-size:1em">o</text><text text-anchor="middle" x="40" y="180" fill="currentcolor" style="font-size:1em">o</text><text text-anchor="middle" x="48" y="20" fill="currentcolor" style="font-size:1em">m</text><text text-anchor="middle" x="48" y="52" fill="currentcolor" style="font-size:1em">A</text><text text-anchor="middle" x="48" y="116" fill="currentcolor" style="font-size:1em">B</text><text text-anchor="middle" x="48" y="180" fill="currentcolor" style="font-size:1em">m</text><text text-anchor="middle" x="48" y="212" fill="currentcolor" style="font-size:1em">A</text><text text-anchor="middle" x="48" y="276" fill="currentcolor" style="font-size:1em">B</text><text text-anchor="middle" x="96" y="20" fill="currentcolor" style="font-size:1em">t</text><text text-anchor="middle" x="96" y="180" fill="currentcolor" style="font-size:1em">t</text><text text-anchor="middle" x="104" y="20" fill="currentcolor" style="font-size:1em">o</text><text text-anchor="middle" x="104" y="180" fill="currentcolor" style="font-size:1em">o</text><text text-anchor="middle" x="104" y="212" fill="currentcolor" style="font-size:1em">A</text><text text-anchor="middle" x="104" y="276" fill="currentcolor" style="font-size:1em">B</text><text text-anchor="middle" x="192" y="20" fill="currentcolor" style="font-size:1em">f</text><text text-anchor="middle" x="192" y="180" fill="currentcolor" style="font-size:1em">f</text><text text-anchor="middle" x="200" y="20" fill="currentcolor" style="font-size:1em">r</text><text text-anchor="middle" x="200" y="180" fill="currentcolor" style="font-size:1em">r</text><text text-anchor="middle" x="208" y="20" fill="currentcolor" style="font-size:1em">o</text><text text-anchor="middle" x="208" y="180" fill="currentcolor" style="font-size:1em">o</text><text text-anchor="middle" x="216" y="20" fill="currentcolor" style="font-size:1em">m</text><text text-anchor="middle" x="216" y="52" fill="currentcolor" style="font-size:1em">A</text><text text-anchor="middle" x="216" y="116" fill="currentcolor" style="font-size:1em">B</text><text text-anchor="middle" x="216" y="180" fill="currentcolor" style="font-size:1em">m</text><text text-anchor="middle" x="216" y="212" fill="currentcolor" style="font-size:1em">A</text><text text-anchor="middle" x="216" y="276" fill="currentcolor" style="font-size:1em">B</text><text text-anchor="middle" x="264" y="20" fill="currentcolor" style="font-size:1em">t</text><text text-anchor="middle" x="264" y="180" fill="currentcolor" style="font-size:1em">t</text><text text-anchor="middle" x="272" y="20" fill="currentcolor" style="font-size:1em">o</text><text text-anchor="middle" x="272" y="52" fill="currentcolor" style="font-size:1em">A</text><text text-anchor="middle" x="272" y="180" fill="currentcolor" style="font-size:1em">o</text><text text-anchor="middle" x="272" y="212" fill="currentcolor" style="font-size:1em">A</text><text text-anchor="middle" x="272" y="276" fill="currentcolor" style="font-size:1em">B</text><text text-anchor="middle" x="272" y="340" fill="currentcolor" style="font-size:1em">A</text></g></svg></div></div><h4 id=example>Example</h4><div class="goat svg-container"><svg xmlns="http://www.w3.org/2000/svg" font-family="Menlo,Lucida Console,monospace" viewBox="0 0 328 313"><g transform="translate(8,16)"><path d="M0 0H72" fill="none" stroke="currentcolor"/><path d="M72 0h72" fill="none" stroke="currentcolor"/><path d="M168 0h72" fill="none" stroke="currentcolor"/><path d="M240 0h72" fill="none" stroke="currentcolor"/><path d="M16 48H32" fill="none" stroke="currentcolor"/><path d="M184 48h16" fill="none" stroke="currentcolor"/><path d="M216 48h24" fill="none" stroke="currentcolor"/><path d="M240 48h16" fill="none" stroke="currentcolor"/><path d="M16 112H32" fill="none" stroke="currentcolor"/><path d="M184 112h16" fill="none" stroke="currentcolor"/><path d="M0 128H72" fill="none" stroke="currentcolor"/><path d="M72 128h72" fill="none" stroke="currentcolor"/><path d="M168 128h72" fill="none" stroke="currentcolor"/><path d="M240 128h72" fill="none" stroke="currentcolor"/><path d="M0 160H72" fill="none" stroke="currentcolor"/><path d="M72 160h72" fill="none" stroke="currentcolor"/><path d="M168 160h72" fill="none" stroke="currentcolor"/><path d="M240 160h72" fill="none" stroke="currentcolor"/><path d="M16 208H32" fill="none" stroke="currentcolor"/><path d="M48 208H72" fill="none" stroke="currentcolor"/><path d="M72 208H88" fill="none" stroke="currentcolor"/><path d="M16 272H32" fill="none" stroke="currentcolor"/><path d="M48 272H72" fill="none" stroke="currentcolor"/><path d="M72 272H88" fill="none" stroke="currentcolor"/><path d="M0 288H72" fill="none" stroke="currentcolor"/><path d="M72 288h72" fill="none" stroke="currentcolor"/><path d="M168 288h72" fill="none" stroke="currentcolor"/><path d="M240 288h72" fill="none" stroke="currentcolor"/><path d="M0 0V128" fill="none" stroke="currentcolor"/><path d="M0 160V288" fill="none" stroke="currentcolor"/><path d="M16 48v64" fill="none" stroke="currentcolor"/><path d="M16 208v64" fill="none" stroke="currentcolor"/><path d="M48 64V80" fill="none" stroke="currentcolor"/><path d="M48 208v32" fill="none" stroke="currentcolor"/><path d="M72 0V128" fill="none" stroke="currentcolor"/><path d="M72 160v48" fill="none" stroke="currentcolor"/><path d="M72 208v64" fill="none" stroke="currentcolor"/><path d="M72 272v16" fill="none" stroke="currentcolor"/><path d="M104 224v16" fill="none" stroke="currentcolor"/><path d="M144 0V128" fill="none" stroke="currentcolor"/><path d="M144 160V288" fill="none" stroke="currentcolor"/><path d="M168 0V128" fill="none" stroke="currentcolor"/><path d="M168 160V288" fill="none" stroke="currentcolor"/><path d="M184 48v64" fill="none" stroke="currentcolor"/><path d="M216 48V80" fill="none" stroke="currentcolor"/><path d="M240 0V48" fill="none" stroke="currentcolor"/><path d="M240 48v80" fill="none" stroke="currentcolor"/><path d="M240 160V288" fill="none" stroke="currentcolor"/><path d="M272 224v16" fill="none" stroke="currentcolor"/><path d="M312 0V128" fill="none" stroke="currentcolor"/><path d="M312 160V288" fill="none" stroke="currentcolor"/><polygon points="40.000000,48.000000 28.000000,42.400002 28.000000,53.599998" fill="currentcolor" transform="rotate(0.000000, 32.000000, 48.000000)"/><polygon points="40.000000,208.000000 28.000000,202.399994 28.000000,213.600006" fill="currentcolor" transform="rotate(0.000000, 32.000000, 208.000000)"/><polygon points="56.000000,80.000000 44.000000,74.400002 44.000000,85.599998" fill="currentcolor" transform="rotate(90.000000, 48.000000, 80.000000)"/><polygon points="56.000000,240.000000 44.000000,234.399994 44.000000,245.600006" fill="currentcolor" transform="rotate(90.000000, 48.000000, 240.000000)"/><polygon points="96.000000,208.000000 84.000000,202.399994 84.000000,213.600006" fill="currentcolor" transform="rotate(0.000000, 88.000000, 208.000000)"/><polygon points="96.000000,272.000000 84.000000,266.399994 84.000000,277.600006" fill="currentcolor" transform="rotate(0.000000, 88.000000, 272.000000)"/><polygon points="112.000000,240.000000 100.000000,234.399994 100.000000,245.600006" fill="currentcolor" transform="rotate(90.000000, 104.000000, 240.000000)"/><polygon points="208.000000,48.000000 196.000000,42.400002 196.000000,53.599998" fill="currentcolor" transform="rotate(0.000000, 200.000000, 48.000000)"/><polygon points="224.000000,80.000000 212.000000,74.400002 212.000000,85.599998" fill="currentcolor" transform="rotate(90.000000, 216.000000, 80.000000)"/><polygon points="264.000000,48.000000 252.000000,42.400002 252.000000,53.599998" fill="currentcolor" transform="rotate(0.000000, 256.000000, 48.000000)"/><polygon points="280.000000,240.000000 268.000000,234.399994 268.000000,245.600006" fill="currentcolor" transform="rotate(90.000000, 272.000000, 240.000000)"/><circle cx="48" cy="208" r="6" stroke="currentcolor" fill="#fff"/><circle cx="48" cy="272" r="6" stroke="currentcolor" fill="#fff"/><circle cx="216" cy="48" r="6" stroke="currentcolor" fill="#fff"/><text text-anchor="middle" x="24" y="20" fill="currentcolor" style="font-size:1em">f</text><text text-anchor="middle" x="24" y="180" fill="currentcolor" style="font-size:1em">f</text><text text-anchor="middle" x="32" y="20" fill="currentcolor" style="font-size:1em">r</text><text text-anchor="middle" x="32" y="180" fill="currentcolor" style="font-size:1em">r</text><text text-anchor="middle" x="40" y="20" fill="currentcolor" style="font-size:1em">o</text><text text-anchor="middle" x="40" y="180" fill="currentcolor" style="font-size:1em">o</text><text text-anchor="middle" x="48" y="20" fill="currentcolor" style="font-size:1em">m</text><text text-anchor="middle" x="48" y="52" fill="currentcolor" style="font-size:1em">A</text><text text-anchor="middle" x="48" y="116" fill="currentcolor" style="font-size:1em">B</text><text text-anchor="middle" x="48" y="180" fill="currentcolor" style="font-size:1em">m</text><text text-anchor="middle" x="96" y="20" fill="currentcolor" style="font-size:1em">t</text><text text-anchor="middle" x="96" y="180" fill="currentcolor" style="font-size:1em">t</text><text text-anchor="middle" x="104" y="20" fill="currentcolor" style="font-size:1em">o</text><text text-anchor="middle" x="104" y="180" fill="currentcolor" style="font-size:1em">o</text><text text-anchor="middle" x="104" y="212" fill="currentcolor" style="font-size:1em">A</text><text text-anchor="middle" x="104" y="276" fill="currentcolor" style="font-size:1em">B</text><text text-anchor="middle" x="192" y="20" fill="currentcolor" style="font-size:1em">f</text><text text-anchor="middle" x="192" y="180" fill="currentcolor" style="font-size:1em">t</text><text text-anchor="middle" x="200" y="20" fill="currentcolor" style="font-size:1em">r</text><text text-anchor="middle" x="200" y="180" fill="currentcolor" style="font-size:1em">o</text><text text-anchor="middle" x="208" y="20" fill="currentcolor" style="font-size:1em">o</text><text text-anchor="middle" x="216" y="20" fill="currentcolor" style="font-size:1em">m</text><text text-anchor="middle" x="216" y="116" fill="currentcolor" style="font-size:1em">B</text><text text-anchor="middle" x="264" y="20" fill="currentcolor" style="font-size:1em">t</text><text text-anchor="middle" x="264" y="180" fill="currentcolor" style="font-size:1em">f</text><text text-anchor="middle" x="272" y="20" fill="currentcolor" style="font-size:1em">o</text><text text-anchor="middle" x="272" y="52" fill="currentcolor" style="font-size:1em">A</text><text text-anchor="middle" x="272" y="180" fill="currentcolor" style="font-size:1em">r</text><text text-anchor="middle" x="272" y="212" fill="currentcolor" style="font-size:1em">A</text><text text-anchor="middle" x="272" y="276" fill="currentcolor" style="font-size:1em">B</text><text text-anchor="middle" x="280" y="180" fill="currentcolor" style="font-size:1em">o</text><text text-anchor="middle" x="288" y="180" fill="currentcolor" style="font-size:1em">m</text></g></svg></div><h4 id=pros-2>Pros</h4><ul><li>The gc will collect all garbage</li><li>Efficient memory utilization (all allocations are contiguous: no fragmentation)</li><li>Only $1$ iteration (as opposed to $2$ from mark/sweep)</li></ul><h4 id=cons-2>Cons</h4><ul><li>Long pauses when gc is running</li><li>Only half of the heap can be operated on at a time</li></ul><h2 id=lifetime-optimization>Lifetime Optimization</h2><p>A general analysis of programs yields the following result.</p><ul><li>Allocated memory blocks that live past a certain point tend to live a really long time</li><li>Other blocks tend to be short lived</li></ul><p>This sort of makes sense. These long lasting blocks are likely to be data structures that persist throughout the program. On the other hand, short lived blocks might be temporaries that we only need for a scope (i.e. within function).</p><p>An optimization to employ is <strong>generational collection</strong>. The heap is divided into two sections: <em>nursery</em> and <em>tenured</em>.</p><div class="goat svg-container"><svg xmlns="http://www.w3.org/2000/svg" font-family="Menlo,Lucida Console,monospace" viewBox="0 0 432 169"><g transform="translate(8,16)"><path d="M0 0H208" fill="none" stroke="currentcolor"/><path d="M208 0H416" fill="none" stroke="currentcolor"/><path d="M0 144H208" fill="none" stroke="currentcolor"/><path d="M208 144H416" fill="none" stroke="currentcolor"/><path d="M0 0V144" fill="none" stroke="currentcolor"/><path d="M208 0V144" fill="none" stroke="currentcolor"/><path d="M416 0V144" fill="none" stroke="currentcolor"/><text text-anchor="middle" x="80" y="68" fill="currentcolor" style="font-size:1em">n</text><text text-anchor="middle" x="88" y="68" fill="currentcolor" style="font-size:1em">u</text><text text-anchor="middle" x="88" y="84" fill="currentcolor" style="font-size:1em">[</text><text text-anchor="middle" x="96" y="68" fill="currentcolor" style="font-size:1em">r</text><text text-anchor="middle" x="96" y="84" fill="currentcolor" style="font-size:1em">n</text><text text-anchor="middle" x="104" y="68" fill="currentcolor" style="font-size:1em">s</text><text text-anchor="middle" x="104" y="84" fill="currentcolor" style="font-size:1em">e</text><text text-anchor="middle" x="112" y="68" fill="currentcolor" style="font-size:1em">e</text><text text-anchor="middle" x="112" y="84" fill="currentcolor" style="font-size:1em">w</text><text text-anchor="middle" x="120" y="68" fill="currentcolor" style="font-size:1em">r</text><text text-anchor="middle" x="120" y="84" fill="currentcolor" style="font-size:1em">]</text><text text-anchor="middle" x="128" y="68" fill="currentcolor" style="font-size:1em">y</text><text text-anchor="middle" x="288" y="68" fill="currentcolor" style="font-size:1em">t</text><text text-anchor="middle" x="296" y="68" fill="currentcolor" style="font-size:1em">e</text><text text-anchor="middle" x="296" y="84" fill="currentcolor" style="font-size:1em">[</text><text text-anchor="middle" x="304" y="68" fill="currentcolor" style="font-size:1em">n</text><text text-anchor="middle" x="304" y="84" fill="currentcolor" style="font-size:1em">o</text><text text-anchor="middle" x="312" y="68" fill="currentcolor" style="font-size:1em">u</text><text text-anchor="middle" x="312" y="84" fill="currentcolor" style="font-size:1em">l</text><text text-anchor="middle" x="320" y="68" fill="currentcolor" style="font-size:1em">r</text><text text-anchor="middle" x="320" y="84" fill="currentcolor" style="font-size:1em">d</text><text text-anchor="middle" x="328" y="68" fill="currentcolor" style="font-size:1em">e</text><text text-anchor="middle" x="328" y="84" fill="currentcolor" style="font-size:1em">]</text><text text-anchor="middle" x="336" y="68" fill="currentcolor" style="font-size:1em">d</text></g></svg></div><p>All newly allocated blocks are placed in the <em>nursery</em>. When a <em>nursery</em> gc triggers and cleans up the trash, all blocks that were not cleaned up are &ldquo;promoted&rdquo; to live in the <em>tenured</em> space. There is also a <em>tenured</em> gc, but that executes less frequently than the <em>nursery</em> gc (since those blocks are less likely to be garbage).<div class="box box-shortcode info"><span class="icon-box baseline"><svg><use href="#info-box"/></svg></span><p>Observe that after a <em>nursery</em> gc execution, the entire <em>nursery</em> is freed. Much like in <strong>copy collection</strong>, we can just reclaim the entire space at once rather than for each individual block.</p></div></p><h2 id=type-unsafe-problem>Type Unsafe Problem</h2><p>Lots of higher-level programming languages have type systems that keep code &ldquo;safe&rdquo;. In a lower-level language like $\texttt{C/C++}$, anything goes. Specifically, any piece of data could be casted to a pointer.</p><div class="box box-shortcode info"><span class="icon-box baseline"><svg><use href="#info-box"/></svg></span><p>For instance, $\texttt{int x = 5}$ could technically also be a pointer to the memory address $\texttt{0x5}$.</p></div><p>An approach is to employ <strong>conservative collection</strong>. Any <em>data</em> in scope is conservatively considered to be a pointer. If there exists allocated memory at the address specified by that data, then consider it &ldquo;not garbage&rdquo; (don&rsquo;t free it).</p><div class="box box-shortcode info"><span class="icon-box baseline"><svg><use href="#info-box"/></svg></span><p>If we had $\texttt{int x = 5}$ and there was $\texttt{Object obj}$ allocated at address $\texttt{0x4}$ with size $\texttt{0x8}$, then consider $\texttt{obj}$ to be in use.</p><p>The reason being is that we could technically use $\texttt{x}$ to access $\texttt{obj}$, so we can&rsquo;t deem $\texttt{obj}$ as garbage yet.</p></div><p>It&rsquo;s a conservative approach because the gc might falsely mark a piece of memory as still in use, thus leaking it.</p></section><footer class=article-footer><section class=article-tags><a href=/tags/reference-counting/>reference counting</a>
<a href=/tags/mark-sweep/>mark sweep</a>
<a href=/tags/copy-collection/>copy collection</a>
<a href=/tags/generational-collection/>generational collection</a>
<a href=/tags/conservative-collection/>conservative collection</a></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.css integrity="sha256-J+iAE0sgH8QSz9hpcDxXIftnj65JEZgNhGcgReTTK9s=" crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.js integrity="sha256-InsNdER1b2xUewP+pKCUJpkhiqwHgqiPXDlIk7GzBu4=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/auto-render.min.js integrity="sha256-y39Mpg7V3D4lhBX4x6O0bUqTV4pSrfgwEfGKfxkOdgI=" crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.querySelector(`.article-content`),{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})</script></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/p/convex-hull/><div class=article-image><img src=/p/convex-hull/metal.2e23876174dd066b894a6336ef9f5f0b_hucc82ca6d3bed3ea7cfbb5d52fcf5f20d_4026746_250x150_fill_q75_box_smart1.jpeg width=250 height=150 loading=lazy alt="Featured image of post Convex Hull" data-key=convex-hull data-hash="md5-LiOHYXTdBmuJSmM2759fCw=="></div><div class=article-details><h2 class=article-title>Convex Hull</h2></div></a></article><article class=has-image><a href=/p/dynamic-dispatch/><div class=article-image><img src=/p/dynamic-dispatch/blocks.cc133e5fa3bb56eefda72815f0aa3c09_hu9616bf3caa0d73a3d5bc25029cdd48a0_1391911_250x150_fill_q75_box_smart1.jpg width=250 height=150 loading=lazy alt="Featured image of post Dynamic Dispatch: Memory Organization" data-key=dynamic-dispatch data-hash="md5-zBM+X6O7Vu79pygV8Ko8CQ=="></div><div class=article-details><h2 class=article-title>Dynamic Dispatch: Memory Organization</h2></div></a></article><article class=has-image><a href=/p/451-universal-and-perfect-hashing/><div class=article-image><img src=/p/451-universal-and-perfect-hashing/_hu31bed5500aef27fb3896f5273832a229_13876465_7ec83e7b4b671791f00c5a0ab869029e.jpg width=250 height=150 loading=lazy alt="Featured image of post V. Universal and Perfect Hashing" data-key=451-universal-and-perfect-hashing data-hash="md5-5lJ+4Z2UER8XtO6ML907mA=="></div><div class=article-details><h2 class=article-title>V. Universal and Perfect Hashing</h2></div></a></article><article class=has-image><a href=/p/451-splay-trees/><div class=article-image><img src=/p/451-splay-trees/waterfall_forest.3e53324d9ba0e03c81b886f26e014ac9_hu58107b35344101924e39ea2edc9e9f45_5735995_250x150_fill_q75_box_smart1.jpg width=250 height=150 loading=lazy alt="Featured image of post IV. Splay Trees" data-key=451-splay-trees data-hash="md5-PlMyTZug4DyBuIbybgFKyQ=="></div><div class=article-details><h2 class=article-title>IV. Splay Trees</h2></div></a></article><article class=has-image><a href=/p/451-amortized-analysis/><div class=article-image><img src=/p/451-amortized-analysis/_hu4175320c3e1c0627b37f06fe8d92c9ae_1745274_3da09fdb0ff34e57af1b22da0822ccdf.jpg width=250 height=150 loading=lazy alt="Featured image of post III. Amortized Analysis" data-key=451-amortized-analysis data-hash="md5-VQr5JbNocmu2hDQrvEFwag=="></div><div class=article-details><h2 class=article-title>III. Amortized Analysis</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2023 glee</section><section class=powerby>My heart is in the work â€• Andrew Carnegie<br>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.17.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>